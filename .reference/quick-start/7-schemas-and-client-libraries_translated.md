<!-- TRANSLATED by md-translate -->
# Tutorial 7: Schemas & client libraries

# Учебник 7: Схемы и клиентские библиотеки

---

**DEPRECATION NOTICE:** Use of CoreAPI-based schemas were deprecated with the introduction of native OpenAPI-based schema generation as of Django REST Framework v3.10. See the [Version 3.10 Release Announcement](../community/3.10-announcement.md) for more details.

** Уведомление об ископке: ** Использование схем на основе Coreapi было устарело с введением нативного генерации схем на основе OpenAPI на расстоянии Django Rest Framework v3.10.
См. Объявление [версия 3.10 выпуска] (../ Community/3.10-Annoument.md) для получения более подробной информации.

If you are looking for information regarding schemas, you might want to look at these updated resources:

Если вы ищете информацию о схемах, вы можете посмотреть на эти обновленные ресурсы:

1. [Schema](../api-guide/schemas.md)
2. [Documenting your API](../topics/documenting-your-api.md)

1. [Схема] (../ API-Guide/Schemas.md)
2. [документирование вашего API] (../ Темы/документирование-your-api.md)

---

A schema is a machine-readable document that describes the available API endpoints, their URLS, and what operations they support.

Схема-это машино читаемый документ, который описывает доступные конечные точки API, их URL-адреса и какие операции они поддерживают.

Schemas can be a useful tool for auto-generated documentation, and can also be used to drive dynamic client libraries that can interact with the API.

Схемы могут быть полезным инструментом для автоматической документации, а также могут использоваться для управления динамическими клиентскими библиотеками, которые могут взаимодействовать с API.

## Core API

## Core API

In order to provide schema support REST framework uses [Core API](https://www.coreapi.org/).

Чтобы обеспечить схему поддержки Framework REST -Framework [Core API] (https://www.coreapi.org/).

Core API is a document specification for describing APIs. It is used to provide an internal representation format of the available endpoints and possible interactions that an API exposes. It can either be used server-side, or client-side.

Core API является спецификацией документа для описания API.
Он используется для обеспечения внутреннего формата представления доступных конечных точек и возможных взаимодействий, которые API обнажает.
Его можно использовать либо на стороне сервера, либо на стороне клиента.

When used server-side, Core API allows an API to support rendering to a wide range of schema or hypermedia formats.

При использовании серверной стороны, Core API позволяет API поддерживать рендеринг в широком диапазоне форматов схемы или гипермедиа.

When used client-side, Core API allows for dynamically driven client libraries that can interact with any API that exposes a supported schema or hypermedia format.

При использовании клиентской стороны Core API позволяет динамически управлять клиентскими библиотеками, которые могут взаимодействовать с любым API, который обнажает поддерживаемую схему или формат гипермедиа.

## Adding a schema

## Добавление схемы

REST framework supports either explicitly defined schema views, or automatically generated schemas. Since we're using viewsets and routers, we can simply use the automatic schema generation.

Структура REST поддерживает либо явно определенные представления схемы, либо автоматически сгенерированные схемы.
Поскольку мы используем виды и маршрутизаторы, мы можем просто использовать генерацию автоматической схемы.

You'll need to install the `coreapi` python package in order to include an API schema, and `pyyaml` to render the schema into the commonly used YAML-based OpenAPI format.

Вам нужно будет установить пакет Python `coreapi`, чтобы включить схему API, и Pyyaml`, чтобы представить схему в широко используемый формат OpenAPI на основе YAML.

```
$ pip install coreapi pyyaml
```

We can now include a schema for our API, by including an autogenerated schema view in our URL configuration.

Теперь мы можем включить схему для нашего API, включив в нашу конфигурацию URL конфигурацию URL.

```python
from rest_framework.schemas import get_schema_view

schema_view = get_schema_view(title='Pastebin API')

urlpatterns = [
    path('schema/', schema_view),
    ...
]
```

If you visit the `/schema/` endpoint in a browser you should now see `corejson` representation become available as an option.

Если вы посетите конечную точку `/schema/` в браузере, вам теперь следует увидеть, как представление `coerjson` станет доступным в качестве опции.

![Schema format](../img/corejson-format.png)

! [Формат схемы] (../ img/corejson-format.png)

We can also request the schema from the command line, by specifying the desired content type in the `Accept` header.

Мы также можем запросить схему из командной строки, указав желаемый тип контента в заголовке `Accept`.

```
$ http http://127.0.0.1:8000/schema/ Accept:application/coreapi+json
HTTP/1.0 200 OK
Allow: GET, HEAD, OPTIONS
Content-Type: application/coreapi+json

{
    "_meta": {
        "title": "Pastebin API"
    },
    "_type": "document",
    ...
```

The default output style is to use the [Core JSON](https://www.coreapi.org/specification/encoding/#core-json-encoding) encoding.

Стиль вывода по умолчанию заключается в использовании [Core JSON] (https://www.coreapi.org/specification/encoding/#core-json-encoding).

Other schema formats, such as [Open API](https://openapis.org/) (formerly Swagger) are also supported.

Другие форматы схемы, такие как [Open API] (https://openapis.org/) (ранее Swagger) также поддерживаются.

## Using a command line client

## с помощью клиента командной строки

Now that our API is exposing a schema endpoint, we can use a dynamic client library to interact with the API. To demonstrate this, let's use the Core API command line client.

Теперь, когда наш API обнажает конечную точку схемы, мы можем использовать динамическую клиентскую библиотеку для взаимодействия с API.
Чтобы продемонстрировать это, давайте использовать клиент командной строки Core API.

The command line client is available as the `coreapi-cli` package:

Клиент командной строки доступен как пакет `coreapi-cli`:

```
$ pip install coreapi-cli
```

Now check that it is available on the command line...

Теперь убедитесь, что он доступен в командной строке ...

```
$ coreapi
Usage: coreapi [OPTIONS] COMMAND [ARGS]...

  Command line client for interacting with CoreAPI services.

  Visit https://www.coreapi.org/ for more information.

Options:
  --version  Display the package version number.
  --help     Show this message and exit.

Commands:
...
```

First we'll load the API schema using the command line client.

Сначала мы загрузим схему API с помощью клиента командной строки.

```
$ coreapi get http://127.0.0.1:8000/schema/
<Pastebin API "http://127.0.0.1:8000/schema/">
    snippets: {
        highlight(id)
        list()
        read(id)
    }
    users: {
        list()
        read(id)
    }
```

We haven't authenticated yet, so right now we're only able to see the read only endpoints, in line with how we've set up the permissions on the API.

Мы еще не проверяли подлинность, поэтому сейчас мы можем видеть только конечные точки чтения, в соответствии с тем, как мы установили разрешения на API.

Let's try listing the existing snippets, using the command line client:

Давайте попробуем перечислить существующие фрагменты, используя клиент командной строки:

```
$ coreapi action snippets list
[
    {
        "url": "http://127.0.0.1:8000/snippets/1/",
        "id": 1,
        "highlight": "http://127.0.0.1:8000/snippets/1/highlight/",
        "owner": "lucy",
        "title": "Example",
        "code": "print('hello, world!')",
        "linenos": true,
        "language": "python",
        "style": "friendly"
    },
    ...
```

Some of the API endpoints require named parameters. For example, to get back the highlight HTML for a particular snippet we need to provide an id.

Некоторые из конечных точек API требуют названных параметров.
Например, чтобы вернуть HTML HTML для конкретного фрагмента, нам необходимо предоставить идентификатор.

```
$ coreapi action snippets highlight --param id=1
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html>
<head>
  <title>Example</title>
  ...
```

## Authenticating our client

## аутентификация нашего клиента

If we want to be able to create, edit and delete snippets, we'll need to authenticate as a valid user. In this case we'll just use basic auth.

Если мы хотим иметь возможность создавать, редактировать и удалять фрагменты, нам нужно аутентифицировать подлинность как действительного пользователя.
В этом случае мы просто будем использовать базовую аудиторию.

Make sure to replace the `<username>` and `<password>` below with your actual username and password.

Обязательно замените `<<sername>` и `<Shousle>` ниже вашим фактическим именем пользователя и паролем.

```
$ coreapi credentials add 127.0.0.1 <username>:<password> --auth basic
Added credentials
127.0.0.1 "Basic <...>"
```

Now if we fetch the schema again, we should be able to see the full set of available interactions.

Теперь, если мы снова возьмем схему, мы сможем увидеть полный набор доступных взаимодействий.

```
$ coreapi reload
Pastebin API "http://127.0.0.1:8000/schema/">
    snippets: {
        create(code, [title], [linenos], [language], [style])
        delete(id)
        highlight(id)
        list()
        partial_update(id, [title], [code], [linenos], [language], [style])
        read(id)
        update(id, code, [title], [linenos], [language], [style])
    }
    users: {
        list()
        read(id)
    }
```

We're now able to interact with these endpoints. For example, to create a new snippet:

Теперь мы можем взаимодействовать с этими конечными точками.
Например, чтобы создать новый фрагмент:

```
$ coreapi action snippets create --param title="Example" --param code="print('hello, world')"
{
    "url": "http://127.0.0.1:8000/snippets/7/",
    "id": 7,
    "highlight": "http://127.0.0.1:8000/snippets/7/highlight/",
    "owner": "lucy",
    "title": "Example",
    "code": "print('hello, world')",
    "linenos": false,
    "language": "python",
    "style": "friendly"
}
```

And to delete a snippet:

И удалить фрагмент:

```
$ coreapi action snippets delete --param id=7
```

As well as the command line client, developers can also interact with your API using client libraries. The Python client library is the first of these to be available, and a Javascript client library is planned to be released soon.

Помимо клиента командной строки, разработчики также могут взаимодействовать с вашим API, используя клиентские библиотеки.
Клиентская библиотека Python является первой из них, которая будет доступна, и в ближайшее время планируется выпустить клиентскую библиотеку JavaScript.

For more details on customizing schema generation and using Core API client libraries you'll need to refer to the full documentation.

Для получения более подробной информации о создании схемы настройки и использовании клиентских библиотек Core API вам необходимо обратиться к полной документации.

## Reviewing our work

## Просмотр нашей работы

With an incredibly small amount of code, we've now got a complete pastebin Web API, which is fully web browsable, includes a schema-driven client library, and comes complete with authentication, per-object permissions, and multiple renderer formats.

С невероятно небольшим количеством кода, у нас теперь есть полный веб-API Pastebin, который полностью доступен для веб-обозначения, включает в себя клиентскую библиотеку, основанную на схеме, и поставляется в комплекте с аутентификацией, разрешениями для каждого объекта и форматами многочисленных рендеров.

We've walked through each step of the design process, and seen how if we need to customize anything we can gradually work our way down to simply using regular Django views.

Мы проходили каждый шаг процесса проектирования и увидели, как, если нам нужно настроить все, что мы можем постепенно пройти путь, чтобы просто использовать обычные виды Django.

You can review the final [tutorial code](https://github.com/encode/rest-framework-tutorial) on GitHub, or try out a live example in [the sandbox](https://restframework.herokuapp.com/).

Вы можете просмотреть окончательный [учебный код] (https://github.com/encode/rest-framework-tutorial) на github, или попробуйте пример живого в [The Sandbox] (https://restframework.herokuapp.com
/).

## Onwards and upwards

## Вперед и вверх

We've reached the end of our tutorial. If you want to get more involved in the REST framework project, here are a few places you can start:

Мы достигли конца нашего урока.
Если вы хотите больше участвовать в проекте REST Framework, вот несколько мест, которые вы можете начать:

* Contribute on [GitHub](https://github.com/encode/django-rest-framework) by reviewing and submitting issues, and making pull requests.
* Join the [REST framework discussion group](https://groups.google.com/forum/?fromgroups#!forum/django-rest-framework), and help build the community.
* Follow [the author](https://twitter.com/_tomchristie) on Twitter and say hi.

* Внести свой вклад в [github] (https://github.com/encode/django-rest-framework), просмотрев и отправив вопросы и выполняя запросы на привлечение.
* Присоединяйтесь к дискуссионной группе [REST Framework] (https://groups.google.com/forum/?fromgroups#!forum/django-rest-framework) и помогите создать сообщество.
* Следите за [Автор] (https://twitter.com/_tomchristie) в Твиттере и скажите привет.

**Now go build awesome things.**

** А теперь иди построить потрясающие вещи. **