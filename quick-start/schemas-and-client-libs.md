# Tutorial 7: Schemas & client libraries

A schema is a machine-readable document that describes the available API endpoints, their URLS, and what operations they support.

Схема представляет собой машиночитаемый документ, который описывает доступные конечные точки API, их адресов, и какие операции они поддерживают.

Schemas can be a useful tool for auto-generated documentation, and can also be used to drive dynamic client libraries that can interact with the API.

Они могут быть полезным инструментом для автоматически созданных документов, а также может быть использован для динамического клиентские библиотеки, которые могут взаимодействовать с API.

## Core API

In order to provide schema support REST framework uses [Core API][coreapi].

Для того, чтобы обеспечить поддержку остальной схемы Framework использует [базовый API][coreapi].

Core API is a document specification for describing APIs. It is used to provide an internal representation format of the available endpoints and possible interactions that an API exposes. It can either be used server-side, or client-side.

Базовый API-это спецификация документа для описания интерфейсов. Он использован для того чтобы обеспечить внутреннее представление формата доступных конечных точек и возможные взаимодействия, что предоставляет API. Он может быть использован на стороне сервера или на стороне клиента.

When used server-side, Core API allows an API to support rendering to a wide range of schema or hypermedia formats.

При использовании серверных, базовых API позволяет API для поддержки широкого спектра схемы в форматах гипермедиа.

When used client-side, Core API allows for dynamically driven client libraries that can interact with any API that exposes a supported schema or hypermedia format.

При использовании на стороне клиента, базовый API позволяет динамически управляемые клиентские библиотеки, которые могут взаимодействовать с любым API, который предоставляет поддерживаемые схемы или гипермедиа-формате.

## Adding a schema

REST framework supports either explicitly defined schema views, or automatically generated schemas. Since we're using viewsets and routers, we can simply use the automatic schema generation.

Остальные Framework поддерживает либо явно определен вид схемы, или автоматически сгенерированных схем. Поскольку мы используем viewsets и маршрутизаторов, мы можем просто использовать автоматическую генерацию схемы.

You'll need to install the `coreapi` python package in order to include an API schema, and `pyyaml` to render the schema into the commonly used YAML-based OpenAPI format.

Вам потребуется установить пакет python в `coreapi` для того, чтобы содержать заголовок API-схемы и pyyaml` для отображения схемы в наиболее часто используемых форматах YAML-формат OpenAPI.

```
    $ pip install coreapi pyyaml
```

We can now include a schema for our API, by including an autogenerated schema view in our URL configuration.

Теперь мы можем включать в себя схему для нашего API, в том числе автоматически просмотр схемы в конфигурации URL-адрес.

```python
from rest_framework.schemas import get_schema_view

schema_view = get_schema_view(title='Pastebin API')

urlpatterns = [
    path('schema/', schema_view),
    ...
]
```

If you visit the `/schema/` endpoint in a browser you should now see `corejson` representation become available as an option.

Если вы посетите `конечная точка/схемы/` в браузере теперь вы должны увидеть `corejson` представительство станет доступен в качестве опции.

![Schema format](../img/corejson-format.png)

We can also request the schema from the command line, by specifying the desired content type in the `Accept` header.

Мы также можем запросить схему из командной строки, указав необходимый тип содержимого "принять" заголовка.

```
    $ http http://127.0.0.1:8000/schema/ Accept:application/coreapi+json
    HTTP/1.0 200 OK
    Allow: GET, HEAD, OPTIONS
    Content-Type: application/coreapi+json

    {
        "_meta": {
            "title": "Pastebin API"
        },
        "_type": "document",
        ...
```

The default output style is to use the [Core JSON][corejson] encoding.

Стиль вывода по умолчанию является использование [основной формат JSON][corejson] кодирование.

Other schema formats, such as [Open API][openapi] (formerly Swagger) are also supported.

Другие форматы схем, таких как открытые API][openapi] (ранее чванство) также поддерживаются.

## Using a command line client

Now that our API is exposing a schema endpoint, we can use a dynamic client library to interact with the API. To demonstrate this, let's use the Core API command line client.

Теперь, когда наш API выставляя конечную точку схемы, мы можем использовать динамические библиотеки клиента для взаимодействия с API. Чтобы продемонстрировать это, воспользуемся основной клиент API "командной строки".

The command line client is available as the `coreapi-cli` package:

Клиент командной строки доступен как в `coreapi-Кинк пакет`:

    $ pip install coreapi-cli

Now check that it is available on the command line...

Теперь проверьте, что он доступен в командной строке...

```
    $ coreapi
    Usage: coreapi [OPTIONS] COMMAND [ARGS]...

      Command line client for interacting with CoreAPI services.

      Visit https://www.coreapi.org/ for more information.

    Options:
      --version  Display the package version number.
      --help     Show this message and exit.

    Commands:
    ...
```

First we'll load the API schema using the command line client.

Сначала мы загрузить схему API с помощью клиента командной строки.

```
    $ coreapi get http://127.0.0.1:8000/schema/
    <Pastebin API "http://127.0.0.1:8000/schema/">
        snippets: {
            highlight(id)
            list()
            read(id)
        }
        users: {
            list()
            read(id)
        }
```

We haven't authenticated yet, so right now we're only able to see the read only endpoints, in line with how we've set up the permissions on the API.

Мы еще не прошедшие проверку, поэтому сейчас мы только смогли увидеть читать только конечные точки в соответствии с тем, как мы настроены разрешения на API.

Let's try listing the existing snippets, using the command line client:

Давайте попробуем список существующих фрагментов, с помощью клиента командной строки:

    $ coreapi action snippets list
    [
        {
            "url": "http://127.0.0.1:8000/snippets/1/",
            "id": 1,
            "highlight": "http://127.0.0.1:8000/snippets/1/highlight/",
            "owner": "lucy",
            "title": "Example",
            "code": "print('hello, world!')",
            "linenos": true,
            "language": "python",
            "style": "friendly"
        },
        ...

Some of the API endpoints require named parameters. For example, to get back the highlight HTML for a particular snippet we need to provide an id.

Некоторые из конечных точек API требуют именованные параметры. Например, чтобы вернуть выделите HTML-код для конкретного фрагмента нужно предоставить паспорт.

```
    $ coreapi action snippets highlight --param id=1
    <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

    <html>
    <head>
      <title>Example</title>
      ...
```

## Authenticating our client

If we want to be able to create, edit and delete snippets, we'll need to authenticate as a valid user. In this case we'll just use basic auth.

Если мы хотим иметь возможность создавать, редактировать и удалять фрагменты, нам понадобится для проверки подлинности пользователя. В этом случае мы будем использовать базовую аутентификацию.

Make sure to replace the `<username>` and `<password>` below with your actual username and password.

Убедитесь в том, чтобы заменить `<имя_пользователя>` и `<пароль>` ниже с вашим действительным именем пользователя и паролем.

```
    $ coreapi credentials add 127.0.0.1 <username>:<password> --auth basic
    Added credentials
    127.0.0.1 "Basic <...>"
```

Now if we fetch the schema again, we should be able to see the fullset of available interactions.

Теперь, если мы снова приведу схему, мы должны быть в состоянии видеть полное встраивание имеющихся взаимодействий.

```
    $ coreapi reload
    Pastebin API "http://127.0.0.1:8000/schema/">
        snippets: {
            create(code, [title], [linenos], [language], [style])
            delete(id)
            highlight(id)
            list()
            partial_update(id, [title], [code], [linenos], [language], [style])
            read(id)
            update(id, code, [title], [linenos], [language], [style])
        }
        users: {
            list()
            read(id)
        }
```

We're now able to interact with these endpoints. For example, to create a new snippet:

Теперь мы можем взаимодействовать с этими конечными точками. Например, чтобы создать новый фрагмент:

```
    $ coreapi action snippets create --param title="Example" --param code="print('hello, world')"
    {
        "url": "http://127.0.0.1:8000/snippets/7/",
        "id": 7,
        "highlight": "http://127.0.0.1:8000/snippets/7/highlight/",
        "owner": "lucy",
        "title": "Example",
        "code": "print('hello, world')",
        "linenos": false,
        "language": "python",
        "style": "friendly"
    }
```

And to delete a snippet:

И чтобы удалить фрагмент:

```
    $ coreapi action snippets delete --param id=7
```

As well as the command line client, developers can also interact with your API using client libraries. The Python client library is the first of these to be available, and a Javascript client library is planned to be released soon.

Так же как и клиент командной строки, разработчики могут также взаимодействовать с API с помощью клиентских библиотек. Клиентская библиотека Python-это первый из них были доступны, и клиентская библиотека JavaScript, как планируется, будет выпущен в ближайшее время.

For more details on customizing schema generation and using Core API client libraries you'll need to refer to the full documentation.

Для получения более подробной информации о настройке формирования схем и использование базовых API клиентской библиотеки вам необходимо обратитесь к полной документации.

## Reviewing our work

With an incredibly small amount of code, we've now got a complete pastebin Web API, which is fully web browsable, includes a schema-driven client library, and comes complete with authentication, per-object permissions, and multiple renderer formats.

С невероятно малым количеством кода, теперь у нас есть полноценный сайт Pastebin веб-API, который является полностью веб-браузере, включает в себя схемы управляемой клиентской библиотеки, и поставляется в комплекте с проверкой подлинности на объект разрешения, и несколько форматов визуализации.

We've walked through each step of the design process, and seen how if we need to customize anything we can gradually work our way down to simply using regular Django views.

Мы прошли через каждый шаг процесса проектирования, и видели, как, если нам нужно настроить все, что мы можем постепенно спускаться вниз, чтобы просто с помощью регулярных просмотров Джанго.

You can review the final [tutorial code][repo] on GitHub, or try out a live example in [the sandbox][sandbox].

Вы можете просмотреть окончательной [учебник код][РЕПО] на GitHub, или попробовать живой пример в [песочница][песочница].

## Onwards and upwards

We've reached the end of our tutorial.  If you want to get more involved in the REST framework project, here are a few places you can start:

Мы достигли конца нашего урока. Если вы хотите получить более активное участие в рамках проекта отдохнули, вот несколько мест, вы можете начать:

* Contribute on [GitHub][github] by reviewing and submitting issues, and making pull requests.
* Join the [REST framework discussion group][group], and help build the community.
* Follow [the author][twitter] on Twitter and say hi.

**Now go build awesome things.**

[coreapi]: https://www.coreapi.org/
[corejson]: https://www.coreapi.org/specification/encoding/#core-json-encoding
[openapi]: https://openapis.org/
[repo]: https://github.com/encode/rest-framework-tutorial
[sandbox]: https://restframework.herokuapp.com/
[github]: https://github.com/encode/django-rest-framework
[group]: https://groups.google.com/forum/?fromgroups#!forum/django-rest-framework
[twitter]: https://twitter.com/_tomchristie